#!/bin/bash
CLI="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/cli.sh"

# Errors & warnings
command -v iconv >/dev/null 2>&1 || { echo "Error - iconv not installed. Aborting." >&2; exit 1; }
# Script name
BASH_CLI_SCRIPT_NAME="encode-th"
# Option name
BASH_CLI_OPT_NAME[0]="-d"
BASH_CLI_OPT_ALT_NAME[0]="--dir"
# Argument Types
BASH_CLI_OPT_DATA_TYPE[0]="string"
# Required Arguments
BASH_CLI_MANDATORY_PARAM[3]="0"
# Setting description of the option
BASH_CLI_OPT_DESC[0]="Directory Path to search and recursively fix file encoding for *.th.srt files"

source $CLI

encode() {
  local dir=${BASH_CLI_OPT_VALUE[0]}

  for f in $(find $dir -name '*.th.srt'); do
    mv $f "$f.backup"
    iconv -f ISO-8859-11 -t UTF-8 "$f"
    echo -e "Encoding: $f\nbackup: $f.backup..."
  done

  echo -e "\nDone!"
  exit 1;
}

encode;
